---
- name: Make build directory
  file:
    path: "{{ build_dir }}"
    state: directory

- name: Download Cmake
  get_url:
    url: https://cmake.org/files/v3.2/cmake-{{ cmake_version }}.tar.gz
    dest: "{{ build_dir }}"
    validate_certs: no
  retries: 5

- name: Untar cmake
  command: "tar -zxvf {{ build_dir }}/cmake-{{ cmake_version }}.tar.gz"
  args:
    chdir: "{{ build_dir }}"
    creates: "{{ build_dir }}/cmake-{{ cmake_version }}"

- name: Bootstrap cmake
  shell: "./bootstrap --prefix={{ puppetlabs_build_dir }}"
  args:
    chdir: "{{ build_dir }}/cmake-{{ cmake_version }}"

- name: Run Cmake make
  command: make
  args:
    chdir: "{{ build_dir }}/cmake-{{ cmake_version }}"

- name: Run Cmake make install
  command: make install
  args:
    chdir: "{{ build_dir }}/cmake-{{ cmake_version }}"
