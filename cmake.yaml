---
- name: make build directory
  file:
    path: "{{ build_dir }}"
    state: directory

- name: download cmake
  get_url:
    url: https://cmake.org/files/v3.2/cmake-{{ cmake_version }}.tar.gz
    dest: "{{ build_dir }}"
    validate_certs: no
  register: result
  until: result|succeeded
  retries: 5

- name: untar cmake
  command: "tar -zxvf {{ build_dir }}/cmake-{{ cmake_version }}.tar.gz"
  args:
    chdir: "{{ build_dir }}"
    creates: "{{ build_dir }}/cmake-{{ cmake_version }}"

- name: bootstrap cmake
  shell: "./bootstrap --prefix={{ puppetlabs_build_dir }}"
  args:
    chdir: "{{ build_dir }}/cmake-{{ cmake_version }}"

- name: run cmake make
  command: make
  args:
    chdir: "{{ build_dir }}/cmake-{{ cmake_version }}"

- name: run cmake make install
  command: make install
  args:
    chdir: "{{ build_dir }}/cmake-{{ cmake_version }}"
